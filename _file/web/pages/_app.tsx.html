<!doctype html>
<html lang=en>
<head>
<meta charset=utf-8>
<title>web/pages/_app.tsx - Ciro Santilli</title>
<meta property="og:title" content="web/pages/_app.tsx - Ciro Santilli">
<meta property="og:type" content="website">
<meta property="og:image" content="https://docs.ourbigbook.com/_raw/logo.svg">
<meta property="og:url" content="https://docs.ourbigbook.com/_file/web/pages/_app.tsx">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.1/css/all.min.css" integrity="sha512-9my9Mb2+0YO+I4PUCSwUYO7sEK21Y0STBAiFEYoWtd2VzLEZZ4QARDrZ30hdM1GlioHJ8o8cWQiy8IAb1hy/Hg==" crossorigin="anonymous" referrerpolicy="no-referrer">
<style>@import "../../../_obb/dist/ourbigbook.css";

</style>
<link rel="stylesheet" type="text/css" href="../../../_raw/main.css">
<link rel="shortcut icon" href="../../../_raw/logo.svg">
</head>
<body>
<header
<div class="brand-group">
<a href="../../../" class="brand"><img src="../../../_raw/logo.svg" alt="OurBigBook logo">OurBigBook Docs</a>
<a href="https://ourbigbook.com" class="brand"><img src="../../../_raw/logo.svg" alt="OurBigBook logo"><span class="mobile-hide">OurBigBook.com</span><span class="mobile-show">Site</span></a>
<a href="https://github.com/ourbigbook/ourbigbook"><i class="fab fa-github fa-fw icon"></i> Source code</a>
</div>
</header>
<main class="ourbigbook">
<div class="h top" id="file/web/pages/_app.tsx"><div class="notnav"><span class="file" title="This article is about a file." /><h1><a href="">web/pages/_app.tsx</a></h1></div><nav class="h-nav h-nav-toplevel"><div class="nav file"><b> <a href="../../../_dir">(root)</a> / <a href="../../../_dir/web">web</a> / <a href="../../../_dir/web/pages">pages</a> / <a href="../../../_raw/web/pages/_app.tsx">_app.tsx</a></b></div></nav></div><div class="p"><b>web/pages/_app.tsx</b></div><div class="code"><div><pre><code>import { useRouter } from 'next/router';
import React, { useEffect, useState } from 'react';
import { useReportWebVitals } from 'next/web-vitals'

import {
  aboutUrl,
  contactUrl,
  docsUrl,
  donateUrl,
  googleAnalyticsId,
  log,
  isProduction
} from 'front/config';
import Navbar from 'front/Navbar'
import {
  AppContextProvider,
  FontAwesomeIcon,
  HelpIcon,
  DiscussionIcon,
} from 'front'
import routes from 'front/routes'

// Css
// migrating the local ourbigbook to webpack: https://github.com/ourbigbook/ourbigbook/issues/157
import 'ourbigbook/editor.scss'
import 'style.scss'

function handleRouteChange(url) {
  window.gtag('config', googleAnalyticsId, {
    page_path: url,
  })
}

const routesThatDontUpdatePrevPageNoSignup = new Set([
 routes.userNew(),
 routes.resetPasswordUpdate(),
])

const MyApp = ({ Component, pageProps }) =&gt; {
  const router = useRouter()
  // https://nextjs.org/docs/pages/building-your-application/optimizing/analytics
  useReportWebVitals((metric) =&gt; {
    if (log.perf) {
      console.log(metric)
    }
  })

  const [prevPageNoSignup, setPrevPageNoSignup] = useState({ prev: null, cur: null });
  function updatePrevPageNoSignup(newCur, route) {
    // This is so that for logged off user the sequence:
    // - Create new article button
    if (!routesThatDontUpdatePrevPageNoSignup.has(route)) {
      const newVal = {
        prev: prevPageNoSignup.cur,
        cur: newCur,
      }
      setPrevPageNoSignup(newVal)
    }
  }
  useEffect(() =&gt; {
      updatePrevPageNoSignup(router?.asPath, router?.route)
    },
    [router?.asPath, router?.route]
  )
  // Google Analytics page switches:
  // https://stackoverflow.com/questions/60411351/how-to-use-google-analytics-with-next-js-app/62552263#62552263
  useEffect(() =&gt; {
    if (isProduction) {
      router.events.on('routeChangeComplete', handleRouteChange)
      return () =&gt; {
        router.events.off('routeChangeComplete', handleRouteChange)
      }
    }
  }, [router.events])

  const isEditor = !!Component.isEditor
  return (
    &lt;AppContextProvider vals={{ prevPageNoSignup: prevPageNoSignup.prev, updatePrevPageNoSignup }} &gt;
      &lt;div className={`toplevel${isEditor ? ' editor' : ''}`}&gt;
        &lt;Navbar {...{
          isEditor,
          clearScoreDelta: pageProps.clearScoreDelta,
          loggedInUser: pageProps.loggedInUser,
          scoreDelta: pageProps.scoreDelta,
        }} /&gt;
        &lt;div className="main"&gt;
          &lt;Component {...pageProps} /&gt;
        &lt;/div&gt;
        {!isEditor &amp;&amp;
          &lt;footer&gt;
            &lt;a href={aboutUrl}&gt;&lt;HelpIcon /&gt; About&lt;/a&gt;
            &lt;a href={donateUrl}&gt;$ Donate&lt;/a&gt;
            &lt;a href={`${docsUrl}#ourbigbook-com-content-license`}&gt;{FontAwesomeIcon(0xf15c)} Content license: CC BY-SA 4.0 unless noted&lt;/a&gt;
            &lt;a href="https://github.com/ourbigbook/ourbigbook/tree/master/web"&gt;{FontAwesomeIcon(0xf09b, { cls: 'fa-brands-400' })} Website source code&lt;/a&gt;
            &lt;a href={contactUrl}&gt;&lt;DiscussionIcon /&gt; Contact, bugs, suggestions, abuse reports&lt;/a&gt;
            &lt;a href="https://mastodon.social/@ourbigbook"&gt;{FontAwesomeIcon(0xf4f6, { cls: 'fa-brands-400' })} @ourbigbook&lt;/a&gt;
            &lt;a href="https://twitter.com/OurBigBook"&gt;{FontAwesomeIcon(0xf099, { cls: 'fa-brands-400' })} @OurBigBook&lt;/a&gt;
            &lt;a href="https://www.youtube.com/@OurBigBook"&gt;{FontAwesomeIcon(0xf167, { cls: 'fa-brands-400' })} @OurBigBook&lt;/a&gt;
          &lt;/footer&gt;
        }
      &lt;/div&gt;
    &lt;/AppContextProvider&gt;
  )
}

export default MyApp;
</code></pre></div></div></main>
<footer>
<div>License: <a href="https://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> unless noted</div>
<div><a href="../../../_dir">Website source code</a></div>
</footer>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2XSEK2ND00"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-2XSEK2ND00');
</script>
<script src="https://giscus.app/client.js"
        data-repo="ourbigbook/ourbigbook"
        data-repo-id="MDEwOlJlcG9zaXRvcnkyMTEyOTA2NzA="
        data-category="giscus"
        data-category-id="DIC_kwDODJgKLs4CZ61S"
        data-mapping="pathname"
        data-strict="0"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="dark_high_contrast"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
<script>
window.ourbigbook_split_headers = false;
window.ourbigbook_html_x_extension = false;
window.ourbigbook_redirect_prefix = "";
</script>
<script src="../../../_obb/dist/ourbigbook_runtime.js"></script><script>ourbigbook_runtime.ourbigbook_runtime()</script></body>
</html>
